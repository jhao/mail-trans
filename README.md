# 邮件汇总系统

一个基于 Python 和 Flask 的自动邮件读取、翻译、汇总并转发的系统，支持定时任务和 Web 界面配置。适用于 163 等提供 IMAP/SMTP 的邮箱，可使用 DeepSeek API 对邮件内容进行翻译和摘要。

## 功能特点

1. **自动检查未读邮件**：后台定时任务每小时检查一次指定邮箱的未读邮件，根据配置的发件人规则筛选。
2. **DeepSeek 翻译与摘要**：调用 DeepSeek 的 API 将邮件内容翻译成中文，并生成简洁概述（摘要）。
3. **目录卡片汇总**：将处理过的多封邮件整理成卡片式目录，点击目录即可跳转到具体内容段落，最终以 HTML 邮件形式转发到指定邮箱。
4. **Web 界面管理**：提供简单的 Web 界面，可查看最近运行记录、手动执行任务、配置 IMAP/SMTP/DeepSeek 参数以及查看系统日志。
5. **系统日志**：所有执行记录都存入日志文件，可在“日志”页面查看成功/失败次数及详细信息。

## 安装步骤

1. **克隆或下载代码**：将本项目文件夹放置在本地工作目录下，例如 `mail_forwarder/`。
2. **创建虚拟环境（可选）**：
   ```bash
   python3 -m venv venv
   source venv/bin/activate
   ```
3. **安装依赖**：
   ```bash
   pip install -r requirements.txt
   ```
4. **运行应用**：
   ```bash
   python app.py
   ```
   默认监听 `0.0.0.0:5000`，可在浏览器中访问 `http://localhost:5000`。

## 使用方法

1. **首次启动**：访问首页会提示没有运行记录，点击导航栏中的“配置”进入配置页面。
2. **配置参数**：填写 IMAP/SMTP 的服务器地址、端口、邮箱账号和授权码；填写转发目标邮箱；可输入多个发件人规则（逗号分隔）；填写 DeepSeek API token。保存后即可生效。
3. **手动运行**：在首页点击“立即执行任务”按钮，会立刻尝试读取邮件并处理，执行结果会在页面提示，并写入日志。
4. **定时任务**：程序启动后会后台运行定时任务，每小时自动执行一次邮件检查和转发。无需手动干预。
5. **查看日志**：点击导航栏“日志”可查看所有历史执行记录，包括时间、成功/失败状态以及消息，页面顶部统计了失败次数。

## 配置文件说明

配置保存在 `config.json` 中，使用 Web 界面生成和更新即可。字段含义如下：

| 字段 | 说明 |
| --- | --- |
| `imap_host` | IMAP 服务器地址（如 `imap.163.com`） |
| `imap_port` | IMAP 端口，通常为 `993` |
| `imap_user` | 邮箱用户名（完整邮箱地址） |
| `imap_pass` | 邮箱登录密码或授权码 |
| `smtp_host` | SMTP 服务器地址（如 `smtp.163.com`） |
| `smtp_port` | SMTP 端口，SSL 通常为 `465` |
| `smtp_user` | SMTP 登录用户名 |
| `smtp_pass` | SMTP 登录密码或授权码 |
| `forward_email` | 汇总邮件的接收者邮箱地址 |
| `senders` | 发件人筛选列表，多个发件人用逗号分隔；为空时不过滤 |
| `deepseek_token` | DeepSeek API 的认证 token |

## 注意事项

- 本项目示例使用了简单的 DeepSeek 接口调用，请根据实际 DeepSeek API 的最新文档调整 `deepseek_translate` 和 `deepseek_summarize` 函数中的接口地址和参数。
- 日志文件 `logs.json` 和配置文件 `config.json` 位于项目根目录，慎重保管以避免泄漏敏感信息。
- 该应用目前不支持在 Web 界面上传附件或处理附件内容，仅处理纯文本/HTML 正文。
- 若定时任务未执行或出现异常，请检查日志页面获取错误信息。

## 授权许可

此项目仅供学习和内部使用，未经授权请勿用于商业用途。